<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QA æ¸¬è©¦ç®¡ç†ç³»çµ± - å”ä½œç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .collaboration-banner {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
        }
        
        .main-content {
            padding: 30px;
        }
        
        .sync-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #bbdefb;
        }
        
        .sync-section h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .sync-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .sync-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .sync-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .sync-btn.success {
            background: #28a745;
        }
        
        .sync-btn.warning {
            background: #ffc107;
            color: #212529;
        }
        
        .sync-btn.danger {
            background: #dc3545;
        }
        
        .status-indicator {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        
        .status-indicator.success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .status-indicator.warning {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        
        .status-indicator.error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        
        .search-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #e9ecef;
        }
        
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .search-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .filter-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .filter-group select {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
        }
        
        .add-rule-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #bbdefb;
        }
        
        .add-rule-section h3 {
            color: #1976d2;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #495057;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .add-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .add-btn:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .rules-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }
        
        .rules-section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
        }
        
        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .rule-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .rule-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .rule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .rule-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .rule-category {
            background: #007bff;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .rule-category.internal { background: #6f42c1; }
        .rule-category.ui { background: #28a745; }
        .rule-category.other { background: #6c757d; }
        
        .rule-description {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.6;
        }
        
        .rule-details {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .rule-details h4 {
            color: #495057;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        
        .rule-details ul {
            margin-left: 20px;
            color: #6c757d;
        }
        
        .rule-details li {
            margin-bottom: 5px;
        }
        
        .rule-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }
        
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .edit-btn {
            background: #ffc107;
            color: #212529;
        }
        
        .edit-btn:hover {
            background: #e0a800;
        }
        
        .delete-btn {
            background: #dc3545;
            color: white;
        }
        
        .delete-btn:hover {
            background: #c82333;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #6c757d;
            font-size: 1.1em;
        }
        
        .stats-section {
            background: #e3f2fd;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid #bbdefb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .stat-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #6c757d;
            font-size: 1em;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .modal-header h3 {
            color: #2c3e50;
            margin: 0;
        }
        
        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #000;
        }
        
        @media (max-width: 768px) {
            .search-bar {
                flex-direction: column;
            }
            
            .search-input {
                min-width: 100%;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .rules-grid {
                grid-template-columns: 1fr;
            }
            
            .filter-section {
                grid-template-columns: 1fr;
            }
            
            .sync-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª QA æ¸¬è©¦ç®¡ç†ç³»çµ± - å”ä½œç‰ˆ</h1>
            <p>æ”¯æ´åœ˜éšŠå”ä½œçš„æ¸¬è©¦è¦å‰‡ç®¡ç†ç³»çµ±</p>
        </div>
        
        <div class="collaboration-banner">
            ğŸ¤ å”ä½œåŠŸèƒ½ï¼šæ”¯æ´åœ˜éšŠæˆå“¡åŒæ™‚ç·¨è¼¯å’ŒåŒæ­¥æ•¸æ“š
        </div>
        
        <div class="main-content">
            
            <!-- åŒæ­¥åŠŸèƒ½ -->
            <div class="sync-section">
                <h3>ğŸ”„ æ•¸æ“šåŒæ­¥</h3>
                <div class="sync-buttons">
                    <button class="sync-btn" onclick="downloadData()">ğŸ“¥ ä¸‹è¼‰æœ€æ–°æ•¸æ“š</button>
                    <button class="sync-btn success" onclick="uploadData()">ğŸ“¤ ä¸Šå‚³è®Šæ›´</button>
                    <button class="sync-btn warning" onclick="checkForUpdates()">ğŸ” æª¢æŸ¥æ›´æ–°</button>
                    <button class="sync-btn danger" onclick="clearLocalData()">ğŸ—‘ï¸ æ¸…é™¤æœ¬åœ°æ•¸æ“š</button>
                </div>
                <div id="syncStatus" class="status-indicator" style="display: none;">
                    <!-- åŒæ­¥ç‹€æ…‹å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- çµ±è¨ˆå€åŸŸ -->
            <div class="stats-section">
                <h3>ğŸ“Š ç³»çµ±çµ±è¨ˆ</h3>
                <div class="stats-grid" id="statsGrid">
                    <!-- çµ±è¨ˆæ•¸æ“šå°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div style="text-align: center; margin-top: 20px;">
                    <button class="action-btn edit-btn" onclick="exportData()" style="margin-right: 10px;">ğŸ“¤ åŒ¯å‡ºæ•¸æ“š</button>
                    <button class="action-btn delete-btn" onclick="clearAllData()">ğŸ—‘ï¸ æ¸…é™¤æ‰€æœ‰æ•¸æ“š</button>
                </div>
            </div>
            
            <!-- æœå°‹å€åŸŸ -->
            <div class="search-section">
                <h3>ğŸ” æœå°‹æ¸¬è©¦è¦å‰‡</h3>
                <div class="search-bar">
                    <input type="text" id="searchInput" class="search-input" placeholder="è¼¸å…¥é—œéµå­—æœå°‹æ¸¬è©¦è¦å‰‡...">
                    <button class="search-btn" onclick="searchRules()">æœå°‹</button>
                </div>
                <div class="filter-section">
                    <div class="filter-group">
                        <label>åˆ†é¡ç¯©é¸</label>
                        <select id="categoryFilter">
                            <option value="">å…¨éƒ¨åˆ†é¡</option>
                            <option value="internal">å…§éƒ¨æ¸¬è©¦æ³¨æ„äº‹é …</option>
                            <option value="ui">UIæ¸¬è©¦</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>ç‹€æ…‹ç¯©é¸</label>
                        <select id="statusFilter">
                            <option value="">å…¨éƒ¨ç‹€æ…‹</option>
                            <option value="active">å•Ÿç”¨</option>
                            <option value="inactive">åœç”¨</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <!-- æ–°å¢è¦å‰‡å€åŸŸ -->
            <div class="add-rule-section">
                <h3>â• æ–°å¢æ¸¬è©¦è¦å‰‡</h3>
                <form id="addRuleForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>è¦å‰‡åç¨± *</label>
                            <input type="text" id="ruleName" required>
                        </div>
                        <div class="form-group">
                            <label>åˆ†é¡ *</label>
                            <select id="ruleCategory" required>
                                <option value="">é¸æ“‡åˆ†é¡</option>
                                <option value="internal">å…§éƒ¨æ¸¬è©¦æ³¨æ„äº‹é …</option>
                                <option value="ui">UIæ¸¬è©¦</option>
                                <option value="other">å…¶ä»–</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ç‹€æ…‹</label>
                            <select id="ruleStatus">
                                <option value="active">å•Ÿç”¨</option>
                                <option value="inactive">åœç”¨</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>è¦å‰‡æè¿° *</label>
                        <textarea id="ruleDescription" required placeholder="è©³ç´°æè¿°æ¸¬è©¦è¦å‰‡..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>æ¸¬è©¦æ­¥é©Ÿ</label>
                        <textarea id="ruleSteps" placeholder="åˆ—å‡ºå…·é«”çš„æ¸¬è©¦æ­¥é©Ÿ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>é æœŸçµæœ</label>
                        <textarea id="ruleExpected" placeholder="æè¿°é æœŸçš„æ¸¬è©¦çµæœ..."></textarea>
                    </div>
                    <div class="form-group">
                        <label>å‚™è¨»</label>
                        <textarea id="ruleNotes" placeholder="å…¶ä»–å‚™è¨»è³‡è¨Š..."></textarea>
                    </div>
                    <button type="submit" class="add-btn">æ–°å¢è¦å‰‡</button>
                </form>
            </div>
            
            <!-- è¦å‰‡åˆ—è¡¨å€åŸŸ -->
            <div class="rules-section">
                <h3>ğŸ“‹ æ¸¬è©¦è¦å‰‡åˆ—è¡¨</h3>
                <div class="rules-grid" id="rulesGrid">
                    <!-- è¦å‰‡å¡ç‰‡å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
                </div>
                <div class="no-results" id="noResults" style="display: none;">
                    <p>ğŸ” æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„æ¸¬è©¦è¦å‰‡</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- ç·¨è¼¯è¦å‰‡æ¨¡æ…‹æ¡† -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>âœï¸ ç·¨è¼¯æ¸¬è©¦è¦å‰‡</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <form id="editRuleForm">
                <input type="hidden" id="editRuleId">
                <div class="form-grid">
                    <div class="form-group">
                        <label>è¦å‰‡åç¨± *</label>
                        <input type="text" id="editRuleName" required>
                    </div>
                    <div class="form-group">
                        <label>åˆ†é¡ *</label>
                        <select id="editRuleCategory" required>
                            <option value="internal">å…§éƒ¨æ¸¬è©¦æ³¨æ„äº‹é …</option>
                            <option value="ui">UIæ¸¬è©¦</option>
                            <option value="other">å…¶ä»–</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç‹€æ…‹</label>
                        <select id="editRuleStatus">
                            <option value="active">å•Ÿç”¨</option>
                            <option value="inactive">åœç”¨</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>è¦å‰‡æè¿° *</label>
                    <textarea id="editRuleDescription" required></textarea>
                </div>
                <div class="form-group">
                    <label>æ¸¬è©¦æ­¥é©Ÿ</label>
                    <textarea id="editRuleSteps"></textarea>
                </div>
                <div class="form-group">
                    <label>é æœŸçµæœ</label>
                    <textarea id="editRuleExpected"></textarea>
                </div>
                <div class="form-group">
                    <label>å‚™è¨»</label>
                    <textarea id="editRuleNotes"></textarea>
                </div>
                <div style="text-align: right; margin-top: 20px;">
                    <button type="button" class="action-btn edit-btn" onclick="closeEditModal()">å–æ¶ˆ</button>
                    <button type="submit" class="action-btn add-btn">å„²å­˜è®Šæ›´</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // æ¸¬è©¦è¦å‰‡æ•¸æ“š
        let testRules = [];
        let nextId = 1;
        let lastSyncTime = null;
        
        // å¾localStorageè¼‰å…¥æ•¸æ“š
        function loadData() {
            const savedRules = localStorage.getItem('qaTestRules');
            const savedNextId = localStorage.getItem('qaNextId');
            const savedSyncTime = localStorage.getItem('qaLastSyncTime');
            
            if (savedRules) {
                testRules = JSON.parse(savedRules);
            } else {
                // å¦‚æœæ²’æœ‰ä¿å­˜çš„æ•¸æ“šï¼Œä½¿ç”¨é è¨­ç¯„ä¾‹
                testRules = [
                    {
                        id: 1,
                        name: "ç™»å…¥åŠŸèƒ½æ¸¬è©¦",
                        category: "functional",
                        status: "active",
                        description: "æ¸¬è©¦ç”¨æˆ¶ç™»å…¥åŠŸèƒ½æ˜¯å¦æ­£å¸¸é‹ä½œ",
                        steps: "1. é–‹å•Ÿç™»å…¥é é¢\n2. è¼¸å…¥æœ‰æ•ˆå¸³è™Ÿå¯†ç¢¼\n3. é»æ“Šç™»å…¥æŒ‰éˆ•\n4. é©—è­‰ç™»å…¥æˆåŠŸ",
                        expected: "ç”¨æˆ¶æˆåŠŸç™»å…¥ä¸¦è·³è½‰åˆ°ä¸»é é¢",
                        notes: "éœ€è¦æ¸¬è©¦å¤šç¨®ç™»å…¥æ–¹å¼",
                        createdAt: new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        modifiedBy: "ç³»çµ±"
                    },
                    {
                        id: 2,
                        name: "æŒ‰éˆ•é»æ“Šæ¸¬è©¦",
                        category: "ui",
                        status: "active",
                        description: "æ¸¬è©¦æŒ‰éˆ•é»æ“ŠåŠŸèƒ½æ˜¯å¦æ­£å¸¸",
                        steps: "1. æ‰¾åˆ°ç›®æ¨™æŒ‰éˆ•\n2. é»æ“ŠæŒ‰éˆ•\n3. é©—è­‰æŒ‰éˆ•å›æ‡‰",
                        expected: "æŒ‰éˆ•æ­£å¸¸å›æ‡‰ä¸¦åŸ·è¡Œç›¸æ‡‰åŠŸèƒ½",
                        notes: "æ¸¬è©¦å„ç¨®æŒ‰éˆ•ç‹€æ…‹",
                        createdAt: new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        modifiedBy: "ç³»çµ±"
                    },
                    {
                        id: 3,
                        name: "å…§éƒ¨ç³»çµ±æ•´åˆæ¸¬è©¦",
                        category: "internal",
                        status: "active",
                        description: "æ¸¬è©¦å…§éƒ¨ç³»çµ±é–“çš„æ•´åˆåŠŸèƒ½",
                        steps: "1. ç™»å…¥å…§éƒ¨ç³»çµ±\n2. åŸ·è¡Œæ•´åˆåŠŸèƒ½\n3. æª¢æŸ¥æ•¸æ“šåŒæ­¥",
                        expected: "ç³»çµ±é–“æ•¸æ“šåŒæ­¥æ­£å¸¸",
                        notes: "åƒ…é™å…§éƒ¨äººå“¡æ¸¬è©¦",
                        createdAt: new Date().toISOString(),
                        lastModified: new Date().toISOString(),
                        modifiedBy: "ç³»çµ±"
                    }
                ];
                nextId = 4;
             } 
            if (savedNextId) {
                nextId = parseInt(savedNextId);
            }
            
            if (savedSyncTime) {
                lastSyncTime = savedSyncTime;
            }
        }
        
        // ä¿å­˜æ•¸æ“šåˆ°localStorage
        function saveData() {
            localStorage.setItem('qaTestRules', JSON.stringify(testRules));
            localStorage.setItem('qaNextId', nextId.toString());
            localStorage.setItem('qaLastSyncTime', new Date().toISOString());
        }
        
        // åˆå§‹åŒ–é é¢
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateStats();
            displayRules();
            setupEventListeners();
            checkForUpdates();
        });
        
        // è¨­å®šäº‹ä»¶ç›£è½å™¨
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', function() {
                if (this.value.trim() === '') {
                    displayRules();
                }
            });
            
            document.getElementById('categoryFilter').addEventListener('change', filterRules);
            document.getElementById('statusFilter').addEventListener('change', filterRules);
            
            document.getElementById('addRuleForm').addEventListener('submit', addRule);
            document.getElementById('editRuleForm').addEventListener('submit', updateRule);
        }
        
        // æ›´æ–°çµ±è¨ˆæ•¸æ“š
        function updateStats() {
            const totalRules = testRules.length;
            const activeRules = testRules.filter(rule => rule.status === 'active').length;
            const categories = [...new Set(testRules.map(rule => rule.category))].length;
            
            document.getElementById('statsGrid').innerHTML = `
                <div class="stat-item">
                    <div class="stat-number">${totalRules}</div>
                    <div class="stat-label">ç¸½è¦å‰‡æ•¸</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${activeRules}</div>
                    <div class="stat-label">å•Ÿç”¨è¦å‰‡</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">${categories}</div>
                    <div class="stat-label">åˆ†é¡æ•¸é‡</div>
                </div>
            `;
        }
        
        // é¡¯ç¤ºè¦å‰‡
        function displayRules(rules = testRules) {
            const rulesGrid = document.getElementById('rulesGrid');
            const noResults = document.getElementById('noResults');
            
            if (rules.length === 0) {
                rulesGrid.innerHTML = '';
                noResults.style.display = 'block';
                return;
            }
            
            noResults.style.display = 'none';
            rulesGrid.innerHTML = rules.map(rule => `
                <div class="rule-card">
                    <div class="rule-header">
                        <div class="rule-title">${rule.name}</div>
                        <div class="rule-category ${rule.category}">${getCategoryName(rule.category)}</div>
                    </div>
                    <div class="rule-description">${rule.description}</div>
                    <div class="rule-details">
                        <h4>æ¸¬è©¦æ­¥é©Ÿï¼š</h4>
                        <ul>${rule.steps.split('\n').map(step => `<li>${step}</li>`).join('')}</ul>
                    </div>
                    <div class="rule-details">
                        <h4>é æœŸçµæœï¼š</h4>
                        <p>${rule.expected}</p>
                    </div>
                    ${rule.notes ? `<div class="rule-details"><h4>å‚™è¨»ï¼š</h4><p>${rule.notes}</p></div>` : ''}
                    <div class="rule-details">
                        <h4>æœ€å¾Œä¿®æ”¹ï¼š</h4>
                        <p>${rule.lastModified ? new Date(rule.lastModified).toLocaleString() : 'æœªçŸ¥'} by ${rule.modifiedBy || 'æœªçŸ¥'}</p>
                    </div>
                    <div class="rule-actions">
                        <button class="action-btn edit-btn" onclick="editRule(${rule.id})">ç·¨è¼¯</button>
                        <button class="action-btn delete-btn" onclick="deleteRule(${rule.id})">åˆªé™¤</button>
                    </div>
                </div>
            `).join('');
        }
        
        // æœå°‹è¦å‰‡
        function searchRules() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredRules = testRules.filter(rule => 
                rule.name.toLowerCase().includes(searchTerm) ||
                rule.description.toLowerCase().includes(searchTerm) ||
                rule.steps.toLowerCase().includes(searchTerm) ||
                rule.expected.toLowerCase().includes(searchTerm) ||
                (rule.notes && rule.notes.toLowerCase().includes(searchTerm))
            );
            displayRules(filteredRules);
        }
        
        // ç¯©é¸è¦å‰‡
        function filterRules() {
            const category = document.getElementById('categoryFilter').value;
            const status = document.getElementById('statusFilter').value;
            
            let filteredRules = testRules;
            
            if (category) {
                filteredRules = filteredRules.filter(rule => rule.category === category);
            }
            
            if (status) {
                filteredRules = filteredRules.filter(rule => rule.status === status);
            }
            
            displayRules(filteredRules);
        }
        
        // æ–°å¢è¦å‰‡
        function addRule(e) {
            e.preventDefault();
            
            const newRule = {
                id: nextId++,
                name: document.getElementById('ruleName').value,
                category: document.getElementById('ruleCategory').value,
                status: document.getElementById('ruleStatus').value,
                description: document.getElementById('ruleDescription').value,
                steps: document.getElementById('ruleSteps').value,
                expected: document.getElementById('ruleExpected').value,
                notes: document.getElementById('ruleNotes').value,
                createdAt: new Date().toISOString(),
                lastModified: new Date().toISOString(),
                modifiedBy: prompt('è«‹è¼¸å…¥æ‚¨çš„å§“åï¼ˆç”¨æ–¼è¿½è¹¤ä¿®æ”¹è€…ï¼‰ï¼š') || 'æœªçŸ¥'
            };
            
            testRules.push(newRule);
            saveData();
            updateStats();
            displayRules();
            document.getElementById('addRuleForm').reset();
            
            alert('æ¸¬è©¦è¦å‰‡æ–°å¢æˆåŠŸï¼');
        }
        
        // ç·¨è¼¯è¦å‰‡
        function editRule(id) {
            const rule = testRules.find(r => r.id === id);
            if (!rule) return;
            
            document.getElementById('editRuleId').value = rule.id;
            document.getElementById('editRuleName').value = rule.name;
            document.getElementById('editRuleCategory').value = rule.category;
            document.getElementById('editRuleStatus').value = rule.status;
            document.getElementById('editRuleDescription').value = rule.description;
            document.getElementById('editRuleSteps').value = rule.steps;
            document.getElementById('editRuleExpected').value = rule.expected;
            document.getElementById('editRuleNotes').value = rule.notes;
            
            document.getElementById('editModal').style.display = 'block';
        }
        
        // æ›´æ–°è¦å‰‡
        function updateRule(e) {
            e.preventDefault();
            
            const id = parseInt(document.getElementById('editRuleId').value);
            const ruleIndex = testRules.findIndex(r => r.id === id);
            
            if (ruleIndex !== -1) {
                testRules[ruleIndex] = {
                    ...testRules[ruleIndex],
                    name: document.getElementById('editRuleName').value,
                    category: document.getElementById('editRuleCategory').value,
                    status: document.getElementById('editRuleStatus').value,
                    description: document.getElementById('editRuleDescription').value,
                    steps: document.getElementById('editRuleSteps').value,
                    expected: document.getElementById('editRuleExpected').value,
                    notes: document.getElementById('editRuleNotes').value,
                    lastModified: new Date().toISOString(),
                    modifiedBy: prompt('è«‹è¼¸å…¥æ‚¨çš„å§“åï¼ˆç”¨æ–¼è¿½è¹¤ä¿®æ”¹è€…ï¼‰ï¼š') || 'æœªçŸ¥'
                };
                
                saveData();
                updateStats();
                displayRules();
                closeEditModal();
                alert('æ¸¬è©¦è¦å‰‡æ›´æ–°æˆåŠŸï¼');
            }
        }
        
        // åˆªé™¤è¦å‰‡
        function deleteRule(id) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹æ¸¬è©¦è¦å‰‡å—ï¼Ÿ')) {
                testRules = testRules.filter(rule => rule.id !== id);
                saveData();
                updateStats();
                displayRules();
                alert('æ¸¬è©¦è¦å‰‡åˆªé™¤æˆåŠŸï¼');
            }
        }
        
        // é—œé–‰ç·¨è¼¯æ¨¡æ…‹æ¡†
        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
        }
        
        // ç²å–åˆ†é¡åç¨±
        function getCategoryName(category) {
            const categoryNames = {
                'internal': 'å…§éƒ¨æ¸¬è©¦æ³¨æ„äº‹é …',
                'ui': 'UIæ¸¬è©¦',
                'other': 'å…¶ä»–'
            };
            return categoryNames[category] || category;
        }
        
        // ä¸‹è¼‰æ•¸æ“š
        function downloadData() {
            const data = {
                testRules: testRules,
                nextId: nextId,
                downloadDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `QAæ¸¬è©¦è¦å‰‡_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showSyncStatus('success', 'æ•¸æ“šä¸‹è¼‰æˆåŠŸï¼');
        }
        
        // ä¸Šå‚³æ•¸æ“š
        function uploadData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const data = JSON.parse(e.target.result);
                            if (data.testRules && Array.isArray(data.testRules)) {
                                testRules = data.testRules;
                                nextId = data.nextId || testRules.length + 1;
                                saveData();
                                updateStats();
                                displayRules();
                                showSyncStatus('success', 'æ•¸æ“šä¸Šå‚³æˆåŠŸï¼');
                            } else {
                                showSyncStatus('error', 'æ•¸æ“šæ ¼å¼ä¸æ­£ç¢ºï¼');
                            }
                        } catch (error) {
                            showSyncStatus('error', 'ä¸Šå‚³å¤±æ•—ï¼š' + error.message);
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
        
        // æª¢æŸ¥æ›´æ–°
        function checkForUpdates() {
            showSyncStatus('warning', 'æª¢æŸ¥æ›´æ–°ä¸­...');
            // é€™è£¡å¯ä»¥æ·»åŠ å¯¦éš›çš„æ›´æ–°æª¢æŸ¥é‚è¼¯
            setTimeout(() => {
                showSyncStatus('success', 'å·²æ˜¯æœ€æ–°ç‰ˆæœ¬ï¼');
            }, 1000);
        }
        
        // æ¸…é™¤æœ¬åœ°æ•¸æ“š
        function clearLocalData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æœ¬åœ°æ•¸æ“šå—ï¼Ÿ')) {
                localStorage.removeItem('qaTestRules');
                localStorage.removeItem('qaNextId');
                localStorage.removeItem('qaLastSyncTime');
                loadData();
                updateStats();
                displayRules();
                showSyncStatus('success', 'æœ¬åœ°æ•¸æ“šå·²æ¸…é™¤ï¼');
            }
        }
        
        // é¡¯ç¤ºåŒæ­¥ç‹€æ…‹
        function showSyncStatus(type, message) {
            const statusDiv = document.getElementById('syncStatus');
            statusDiv.className = `status-indicator ${type}`;
            statusDiv.innerHTML = `
                <strong>${type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'âŒ'}</strong>
                ${message}
            `;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }
        
        // åŒ¯å‡ºæ•¸æ“š
        function exportData() {
            const data = {
                testRules: testRules,
                nextId: nextId,
                exportDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `QAæ¸¬è©¦è¦å‰‡_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('æ•¸æ“šåŒ¯å‡ºæˆåŠŸï¼');
        }
        
        // æ¸…é™¤æ‰€æœ‰æ•¸æ“š
        function clearAllData() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ•¸æ“šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸï¼')) {
                if (confirm('å†æ¬¡ç¢ºèªï¼šæ‚¨çœŸçš„è¦åˆªé™¤æ‰€æœ‰æ¸¬è©¦è¦å‰‡å—ï¼Ÿ')) {
                    testRules = [];
                    nextId = 1;
                    localStorage.removeItem('qaTestRules');
                    localStorage.removeItem('qaNextId');
                    localStorage.removeItem('qaLastSyncTime');
                    updateStats();
                    displayRules();
                    alert('æ‰€æœ‰æ•¸æ“šå·²æ¸…é™¤ï¼');
                }
            }
        }
        
        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }
    </script>
</body>
</html>
